---
export interface Props {
  slug: Object;
}

import Mozaik from '../layouts/Mozaik.astro'

import { client } from '../lib/sanityClient.js';
//import { allCategoriesWithPosts } from '../lib/api.js';
import { allPosts } from '../lib/api.js'; // for indexPosts
import { allCategoriesWithPosts } from '../lib/api.js';

const allCategoryData = await client.fetch(allCategoriesWithPosts);
const lang = 'hu'
//import { homePage } from '../lib/api.js';
//const pages = await client.fetch(homePage);
//import { catPages } from '../lib/api.js'; // for Nav

/*
//export async function getStaticPaths() {
  const paths = new Set();
*/
//  const pagess = await client.fetch(alllPages);
//  console.log({pagess})
  //const pages = await client.fetch(catPages)
  const home = allCategoryData?.filter(p => p.index >= 0).shift() || {}
  //console.log({pages})
  const allBlogPosts = await client.fetch(allPosts);
  const indexPosts = allBlogPosts?.filter(p => p.index != !1 && p._lang == lang)
  //console.log(indexPosts.map(p => p._id))

  // Prepare Menuitems (on every post)
  const cats = allCategoryData?.filter(p => p.index >= 0).slice()
  cats.map(cat => {
    //cat.menu = new Object()
    //cat.menu[lang] = new Array()

    const fPosts = cat.posts?.filter(p => p._lang == lang);
    if (cat.abc || cat.order == 'abc') {
      fPosts.sort((a, b) => {
        return a.slug.current.localeCompare(b.slug.current)
      })
    }
    //cat.menu = fPosts
    //cat.menu[lang][slug.current] = fPosts
    cat.posts = fPosts
  })

---

<Mozaik page={home} pages={cats} posts={indexPosts} {lang} summaryfrom="auto"/>

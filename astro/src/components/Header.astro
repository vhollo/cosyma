---
import Debug from 'astro/debug'

const { page, pages, lang } = Astro.props;
//const p = pages.slice()
const cats = pages?.filter(cat => cat.index >= 0) || []
let home
home = home || cats?.shift() || {}
//console.log(cats[2])
---
<nav>
  <input type="checkbox" id="hamburger" hidden/>
  <label for="hamburger" class="mobile">
    <svg class="open h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" /></svg>
    <svg  class="close iconify iconify--bx" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M15 19V5l-8 7z"/></svg>
    <!--<span class="close">X</span>-->
  </label>

  <!--<div>HU | EN</div>-->
  {cats?.length && <ul>
    {cats.map(cat => (
    <li>
    {cat.link ? <a href={`/${cat.slug[lang].current}`}>{cat.menutitle && (cat.menutitle[lang]) || (cat.title && cat.title[lang]) || cat.name[lang] || '?!?'}</a> : <a hidden class="hidden mobile" href={`/${cat.slug[lang].current}`}>{cat.menutitle && (cat.menutitle[lang]) || (cat.title && cat.title[lang]) || cat.name[lang] || '?!?'}</a><span class="desktop" tabindex="0">{cat.menutitle && (cat.menutitle[lang]) || (cat.title && cat.title[lang]) || cat.name[lang] || '?!?'}</span>}
      {cat.dropdown && cat.posts && <ul class="desktop">
      
        {cat.posts.slice(0, cat.dropmax || 4).map(sub => (
        sub._lang == lang && <li>
          <a href={`/${sub.category.slug[lang].current}/${sub.slug.current}`}>{sub.menutitle || sub.name || sub.title}</a>
        </li>
        ))}
      </ul>}
    </li>
    ))}
    <li>
      <details>
        <summary>âš‘</summary>
        <a href="/">Magyar</a>
        <a href="/en">English</a>
        <a href="/de">Deutsch</a>
      </details>
    </li>
  </ul>}
  <a href={`/${home.slug[lang].current == 'hu' ? '' : home.slug[lang].current}`}>
    <img src="/assets/csh_white_notxt.svg" alt=""/>
  </a>
  <a href={`/${home.slug[lang].current == 'hu' ? '' : home.slug[lang].current}`}>
    <h1>{(home.menutitle && home.menutitle[lang]) || (home.title && home.title[lang]) || home.category[lang] || '?!? '}</h1>
  </a>
</nav>

<style>
  :checked ~ label .open {
    display: none;
  }
  :not(:checked) ~ label .close {
    display: none;
  }

  label {
    order: 0;
    flex-shrink: 0;
    stroke: currentColor;
  }
  label svg {
    width: 3rem;
    height: 3rem;
  }
  label:focus + ul, label + ul:focus {
    display: block;
  }

  nav {
    position: fixed;
    top: 0;
    width: 100%;
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    /*align-items:baseline;*/
    /*margin-inline: var(--gutter2);*/
    margin-inline: auto;
    margin-bottom: 7rem;
    line-height: 1.15;
    padding-top: 1rem;
    /*overflow: visible;
    overflow-x: hidden;*/
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    filter: drop-shadow(1px 2px 3px black);
    background-color: var(--shadow);
    z-index: 1;
  }
  /*nav a, nav span {
    display: block;
  }*/
  nav span {
    cursor: default;
  }
  nav > a {
    flex-grow: 0;
  }
  nav > a:first-of-type {
    order: 1;
    padding-left: 1rem;
    margin-left: auto;
  }
  nav > a:last-of-type {
    order: 2;
    flex-grow: 0;
    display: flex;
    height: 8rem;
    align-items: center;
    margin-left: -1ch;
    /*padding-right: 5rem;*/
  }
  nav > a img {
    display: block;
    /*width: 4rem;*/
    height: 8rem;
    /*padding: 0 0 2rem;*/
    margin: -.5rem 0 .5rem;
  }
  nav h1 {
    text-align: end;
    font-weight: lighter;
    font-size: 1.5rem;
    line-height: 1.25em;
    inline-size: min-content;
    font-variant: small-caps;
    font-variant: common-ligatures small-caps; 
    font-style: italic;
    padding: 0 1rem;
    margin: 0;
  }
  /*nav h1 :global(span) {
    display: block;
  }*/
  /*div div {
    background-image: url('/assets/header_notes_wide.png');
    background-position: left center;
    background-size: cover;
    background-repeat: no-repeat;
    margin-block: -1rem;
    flex-grow: 1;
    padding-inline: 2ch;
  }    */
  ul {
    list-style: none;
    padding: 0;
  }
  input ~ ul {
    order: 3;
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    gap: 1ch;
    /*height: 8rem;
    align-items: center;*/
    margin: 0 auto;
    padding-bottom: 1rem;
  }
  input ~ ul > li {
    /*padding-inline-end: 2rem;*/
    font-size: larger;
    position: relative;
    margin-top: 2.75rem;
    height: fit-content;
  }
  input ~ ul > li:last-child {
    width: 4rem;
    margin-left: -3px;
    border-left: none!important;
  }
  input ~ ul > li > a, input ~ ul > li > span {
    color: var(--lighter);
  }

  ul ul {
    /*display: none;*/
    display: block;
    width: 0;
    max-width: 0;
    opacity: 0;
    overflow-x: visible;
    height: 0;
    margin: 0;
    /*background-color: var(--lighter);*/
    /*backdrop-filter: brightness(0.9);*/
    border-left: 3px solid;
    border-bottom: 3px solid;
    border-bottom-left-radius: 0.5rem;
    border-bottom-right-radius: 0.5rem;
    margin-left: -3px;
  }
  ul li:focus-within ul, ul li:hover ul {
    /*display: block;*/
    height: auto;
    opacity: 1;
    transition: opacity .25s;
    transition-delay: .1s
  }
  nav > ul > li:focus-within, nav > ul > li:hover {
    border-left: 3px solid;
    border-top-left-radius: 0.5rem;
    margin-left: -3px;
  }
  
  li a, li span {
    inline-size: max-content;
    padding: .5rem 1rem;
  }
  input ~ ul > li > a, input ~ ul > li > span {
    text-transform: uppercase;
  }

  details {
    position: fixed;
    /*top: -1.8em;*/
    /*right: -6.5em;*/
    right: .5em;
    border-left-width: 3px;
    border-top-width: 3px;
    border-radius: 0.5rem;
    margin: 0 1rem 0 0;
    cursor:default;
    backdrop-filter: blur(160px);
    -webkit-backdrop-filter: blur(160px);
    background-color: var(--shadow);
  }
  summary {
    list-style: none;
    list-style-type: none;
    font-size: xx-large;
    padding: 0 .5rem;
  }
  summary::-webkit-details-marker {display: none; }
  details a {
    padding: .25rem .5rem;
  }

  nav ul a:not(.mobile) {
    display: block;
  }
  .desktop {
    display: none;
  }
  @media screen and (max-width: 768px), (pointer: none) {
    .mobile {
      display: block;
    }

    input ~ ul {
      order: 1;
      display: none;
    }
    input:checked ~ ul/*, .mobile + ul:focus, .mobile + ul:focus-within*/ {
      display: block;
    }
    input ~ ul > li/*, .mobile + ul > li*/ {
      margin-top: 1.5rem;
    }
    input ~ ul > li:last-child/*, .mobile + ul > li:last-child*/ {
      margin-left: 1rem;
    }
    input ~ ul details/*, .mobile + ul details*/ {
      position: static;
    }
  }
  @media screen and (min-width: 769px), !(pointer: none) {
    .desktop {
      display: block;
    }
    .mobile {
      display: none;
    }
  }


</style>
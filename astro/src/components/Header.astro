---
import Debug from 'astro/debug'

const { page, pages, lang } = Astro.props;
//const p = pages.slice()
const cats = pages?.filter(cat => cat.index >= 0) || []
let home
home = home || cats?.shift() || {}
//console.log(cats[2])
---
<nav>
    <a href={`/${home.slug[lang].current == 'hu' ? '' : home.slug[lang].current}`}>
      <img src="/assets/csh_white_notxt.svg" alt=""/>
    </a>
    <a href={`/${home.slug[lang].current == 'hu' ? '' : home.slug[lang].current}`}>
      <h1>{(home.menutitle && home.menutitle[lang]) || (home.title && home.title[lang]) || home.category[lang] || '?!? '}</h1>
    </a>
    <!--<div>HU | EN</div>-->
    {cats?.length && <ul>
        {cats.map(cat => (
        <li>
        {cat.link ? <a href={`/${cat.slug[lang].current}`}>{cat.menutitle && (cat.menutitle[lang]) || (cat.title && cat.title[lang]) || cat.name[lang] || '?!?'}</a> : <span tabindex="0">{cat.menutitle && (cat.menutitle[lang]) || (cat.title && cat.title[lang]) || cat.name[lang] || '?!?'}</span>}
          {cat.dropdown && cat.posts && <ul>
          
            {cat.posts.slice(0, cat.dropmax || 4).map(sub => (
            sub._lang == lang && <li>
              <a href={`/${sub.category.slug[lang].current}/${sub.slug.current}`}>{sub.menutitle || sub.name || sub.title}</a>
            </li>
            ))}
          </ul>}
        </li>
        ))}
        <li>
          <details>
            <summary>⚑</summary>
            <a href="/">Magyar</a>
            <a href="/en">English</a>
            <a href="/de">Deutsch</a>
          </details>
        </li>
      </ul>}
        <!--<li><a href="/">Jelentkezés</a></li>
        <li><a href="/">Előadások</a></li>-->
</nav>

<style>
  nav {
    position: fixed;
    top: 0;
    width: 100%;
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    /*align-items:baseline;*/
    /*margin-inline: var(--gutter2);*/
    margin-inline: auto;
    margin-bottom: 7rem;
    line-height: 1.15;
    padding-top: 1rem;
    /*overflow: visible;
    overflow-x: hidden;*/
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    filter: drop-shadow(1px 2px 3px black);
    background-color: var(--shadow);
  }
  nav:focus-within {
    /*max-height: 1000rem;*/
  }
  nav a, nav span {
    display: block;
  }
  nav span {
    cursor: default;
  }
  nav > a {
    flex-grow: 0;
  }
  nav > a:first-of-type {
    padding-left: 1rem;
  }
  nav > a:last-of-type {
    flex-grow: 0;
    display: flex;
    height: 8rem;
    align-items: center;
    margin-left: -1ch;
    /*padding-right: 5rem;*/
  }
  nav > a img {
    display: block;
    /*width: 4rem;*/
    height: 8rem;
    /*padding: 0 0 2rem;*/
    margin: -.5rem 0 .5rem;
  }
  nav h1 {
    text-align: end;
    font-weight: lighter;
    font-size: 1.5rem;
    line-height: 1.25em;
    inline-size: min-content;
    font-variant: small-caps;
    font-variant: common-ligatures small-caps; 
    font-style: italic;
    padding: 0 1rem;
    margin: 0;
  }
  /*nav h1 :global(span) {
    display: block;
  }*/
  /*div div {
    background-image: url('/assets/header_notes_wide.png');
    background-position: left center;
    background-size: cover;
    background-repeat: no-repeat;
    margin-block: -1rem;
    flex-grow: 1;
    padding-inline: 2ch;
  }    */
  ul {
    list-style: none;
    padding: 0;
  }
  nav > ul {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    gap: 1ch;
    /*height: 8rem;
    align-items: center;*/
    margin: 0 auto;
    padding-bottom: 1rem;
  }
  nav > ul > li {
    /*padding-inline-end: 2rem;*/
    font-size: larger;
    position: relative;
    margin-top: 2.75rem;
    height: fit-content;
  }
  nav > ul > li:last-child {
    width: 4rem;
    margin-left: -3px;
    border-left: none!important;
  }

  ul ul {
    /*display: none;*/
    display: block;
    width: 0;
    max-width: 0;
    opacity: 0;
    overflow-x: visible;
    height: 0;
    margin: 0;
    /*background-color: var(--lighter);*/
    /*backdrop-filter: brightness(0.9);*/
    border-left: 3px solid;
    border-bottom: 3px solid;
    border-bottom-left-radius: 0.5rem;
    border-bottom-right-radius: 0.5rem;
    margin-left: -3px;
  }
  ul li:focus-within ul, ul li:hover ul {
    /*display: block;*/
    height: auto;
    opacity: 1;
    transition: opacity .25s;
    transition-delay: .1s
  }
  nav > ul > li:focus-within, nav > ul > li:hover {
    border-left: 3px solid;
    border-top-left-radius: 0.5rem;
    margin-left: -3px;
  }
  
  li a, li span {
    inline-size: max-content;
    padding: .5rem 1rem;
  }

  details {
    position: absolute;
    /*top: -1.8em;*/
    right: -6.5em;
    border-left-width: 3px;
    border-top-width: 3px;
    border-radius: 0.5rem;
    margin: 0 1rem 0 0;
    cursor:default;
    backdrop-filter: blur(160px);
    -webkit-backdrop-filter: blur(160px);
    background-color: var(--shadow);
  }
  summary {
    list-style: none;
    list-style-type: none;
    font-size: xx-large;
    padding: 0 0.5rem;
  }
  summary::-webkit-details-marker {display: none; }
  details a {
    padding: .25rem .5rem;
  }

</style>